<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="Date.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="twittler.css">
  </head>
  <body>
    <div class="container">
      <div class = "row">
        <div class ="col-md-2 logo">
        <img src ="Images/angry_bird.jpg" alt="Angry Bird">
        </div>
        <div class ="col-md-4">
        <h1>Twittler</h1>
        </div>
      </div>
      <div class ="row">
        <div class ="col-md-10">
          <input class="input" type="text">
        </div>
        <div class ="col-md-2">
          <input class ="tweet" value="Tell the world!" type="submit">
        </div>
      </div>
      <hr>
      <div class ="row"> 
        <div class ="col-md-12 tweets">
        </div>
      </div>
    </div>
   

    <script>
      var times = [];
      var tweets = [];
      var refresh = true;
      var visitor = prompt("What is your username?");

      function filterTweets() {
        refresh = false;
        var name = this.text.slice(1);
        var usersTweets = tweets.filter(function(t) {
          return name === t.className;
        });

        $('.tweets').html('');
        usersTweets.forEach(function(tweet) {
          $('.tweets').prepend(tweet);
        });

        var $back = $('<button></button>');
        $back.text('Back to the stream!');
        $back.addClass('back');
        $('.tweets').append($back);
        $('.back').on('click', showAll);
      }

      function showAll() {
        $('.tweets').html('');
        tweets.forEach(function(tweet) {
          $('.tweets').prepend(tweet);
        });
        refresh = true;
      }

      function updateTimes() {
        times.forEach(function(time) {
          var newTime = parseTwitterDate(time.orig);
          time.div.text(newTime);
        });
      }

      function postTweet(nextTweet) {
        var $newTweet = $('<div></div>');
        var $message = $('<p></p>');
        var $timeStamp = $('<p></p>');
        var $username = $('<a></a>');

        $message.text(nextTweet.message);
        $timeStamp.text(parseTwitterDate(nextTweet.created_at));
        $username.text('@' + nextTweet.user);
        
        $message.addClass('col-md-6');
        $timeStamp.addClass('col-md-4');
        $username.addClass('col-md-2 username');
        $newTweet.addClass(nextTweet.user);

        $newTweet.append($username);
        $newTweet.append($message);
        $newTweet.append($timeStamp);

        times.push({div: $timeStamp, orig: nextTweet.created_at});
        tweets.push($newTweet[0]);
        
        if(refresh) {
          $('.tweets').prepend($newTweet);
        }
        $('.username').on('click', filterTweets);
        
        updateTimes();

      }

      function showTweet() {        
        var tweetList = streams.home;
        var index = tweetList.length - 1;

        var nextTweet = tweetList[index];
        postTweet(nextTweet);
        setTimeout(showTweet, 10000);
      } 
   
      
      
      $(document).ready(function(){
        showTweet();
        $('.tweet').on('click',function() {
          var message = $('.input').val();
          $('.input').val('');
          postTweet({user:visitor, message:message, created_at: new Date()});
        });
      });

    </script>
  
  </body>
</html>
